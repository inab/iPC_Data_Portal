{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.BooleanFilterUI = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactComponentComponent = _interopRequireDefault(require(\"react-component-component\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _utils = require(\"../utils\");\n\nvar _api = _interopRequireDefault(require(\"../../utils/api\"));\n\nvar _config = require(\"../../utils/config\");\n\nvar _BooleanAgg = _interopRequireDefault(require(\"../../Aggs/BooleanAgg\"));\n\nvar _common = require(\"./common\");\n\nrequire(\"./FilterContainerStyle.css\");\n\nvar _Query = _interopRequireDefault(require(\"../../Query\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nvar getFieldDisplayName = function getFieldDisplayName(fieldDisplayNameMap, initialFieldSqon) {\n  return fieldDisplayNameMap[initialFieldSqon.content.field] || initialFieldSqon.content.field;\n};\n\nvar AggsWrapper = function AggsWrapper(_ref) {\n  var children = _ref.children;\n  return _react[\"default\"].createElement(\"div\", {\n    className: \"aggregation-card\"\n  }, children);\n};\n\nvar BooleanFilterUI = function BooleanFilterUI(props) {\n  var _props$onSubmit = props.onSubmit,\n      onSubmit = _props$onSubmit === void 0 ? function (sqon) {} : _props$onSubmit,\n      _props$onCancel = props.onCancel,\n      onCancel = _props$onCancel === void 0 ? function () {} : _props$onCancel,\n      _props$ContainerCompo = props.ContainerComponent,\n      ContainerComponent = _props$ContainerCompo === void 0 ? _common.FilterContainer : _props$ContainerCompo,\n      _props$sqonPath = props.sqonPath,\n      sqonPath = _props$sqonPath === void 0 ? [] : _props$sqonPath,\n      _props$initialSqon = props.initialSqon,\n      initialSqon = _props$initialSqon === void 0 ? {} : _props$initialSqon,\n      field = props.field,\n      _props$fieldDisplayNa = props.fieldDisplayNameMap,\n      fieldDisplayNameMap = _props$fieldDisplayNa === void 0 ? {} : _props$fieldDisplayNa,\n      _props$buckets = props.buckets,\n      buckets = _props$buckets === void 0 ? [] : _props$buckets;\n  var initialState = {\n    localSqon: initialSqon\n  };\n  var initialFieldSqon = (0, _utils.getOperationAtPath)(sqonPath)(initialSqon) || {\n    op: _utils.IN_OP,\n    content: {\n      field: field,\n      value: []\n    }\n  };\n\n  var onSqonSubmit = function onSqonSubmit(s) {\n    return function () {\n      return onSubmit(s.state.localSqon);\n    };\n  };\n\n  var onSelectionChange = function onSelectionChange(s) {\n    return function (_ref2) {\n      var value = _ref2.value;\n      setTimeout(function () {\n        var newOp = {\n          op: _utils.IN_OP,\n          content: {\n            field: field,\n            value: [value.key_as_string]\n          }\n        };\n        s.setState({\n          localSqon: (0, _utils.setSqonAtPath)(sqonPath, newOp)(s.state.localSqon)\n        });\n      }, 0);\n    };\n  };\n\n  var isActive = function isActive(s) {\n    return function (_ref3) {\n      var value = _ref3.value;\n      var op = (0, _utils.getOperationAtPath)(sqonPath)(s.state.localSqon);\n      return value === (op && op.content.value[0]);\n    };\n  };\n\n  var fieldDisplayName = getFieldDisplayName(fieldDisplayNameMap, initialFieldSqon);\n  return _react[\"default\"].createElement(_reactComponentComponent[\"default\"], {\n    initialState: initialState\n  }, function (s) {\n    return _react[\"default\"].createElement(ContainerComponent, {\n      onSubmit: onSqonSubmit(s),\n      onCancel: onCancel\n    }, _react[\"default\"].createElement(_react[\"default\"].Fragment, null, _react[\"default\"].createElement(\"div\", {\n      key: \"header\",\n      className: \"contentSection headerContainer\"\n    }, _react[\"default\"].createElement(\"span\", null, \"\".concat(fieldDisplayName, \"?\"))), _react[\"default\"].createElement(\"div\", {\n      key: \"body\",\n      className: \"contentSection bodyContainer\"\n    }, _react[\"default\"].createElement(_BooleanAgg[\"default\"], {\n      WrapperComponent: AggsWrapper,\n      field: initialFieldSqon.content.field,\n      displayName: fieldDisplayName,\n      buckets: buckets,\n      defaultDisplayKeys: {\n        \"true\": 'Yes',\n        \"false\": 'No'\n      },\n      handleValueClick: onSelectionChange(s),\n      isActive: isActive(s)\n    }))));\n  });\n};\n\nexports.BooleanFilterUI = BooleanFilterUI;\nBooleanFilterUI.propTypes = {\n  onSubmit: _propTypes[\"default\"].func,\n  onCancel: _propTypes[\"default\"].func,\n  ContainerComponent: _propTypes[\"default\"].func,\n  sqonPath: _propTypes[\"default\"].array,\n  initialSqon: _propTypes[\"default\"].object,\n  field: _propTypes[\"default\"].string.isRequired,\n  fieldDisplayNameMap: _propTypes[\"default\"].object,\n  buckets: _propTypes[\"default\"].array\n};\n\nvar _default = function _default(props) {\n  var _props$api = props.api,\n      api = _props$api === void 0 ? _api[\"default\"] : _props$api,\n      _props$arrangerProjec = props.arrangerProjectId,\n      arrangerProjectId = _props$arrangerProjec === void 0 ? _config.PROJECT_ID : _props$arrangerProjec,\n      arrangerProjectIndex = props.arrangerProjectIndex,\n      initialSqon = props.initialSqon,\n      executableSqon = props.executableSqon,\n      sqonPath = props.sqonPath,\n      field = props.field,\n      onSubmit = props.onSubmit,\n      onCancel = props.onCancel,\n      fieldDisplayNameMap = props.fieldDisplayNameMap,\n      opDisplayNameMap = props.opDisplayNameMap,\n      _ContainerComponent = props.ContainerComponent;\n  var gqlField = field.split('.').join('__');\n  var query = \"query($sqon: JSON){\\n    \".concat(arrangerProjectIndex, \" {\\n      aggregations(filters: $sqon) {\\n        \").concat(gqlField, \" {\\n          buckets {\\n            key\\n            key_as_string\\n            doc_count\\n          }\\n        }\\n      }\\n    }\\n  }\");\n  return _react[\"default\"].createElement(_Query[\"default\"], {\n    api: api,\n    projectId: arrangerProjectId,\n    query: query,\n    variables: {\n      sqon: executableSqon\n    },\n    render: function render(_ref4) {\n      var data = _ref4.data,\n          loading = _ref4.loading,\n          error = _ref4.error;\n      return _react[\"default\"].createElement(BooleanFilterUI, {\n        ContainerComponent: function ContainerComponent(_ref5) {\n          var children = _ref5.children,\n              props = _objectWithoutProperties(_ref5, [\"children\"]);\n\n          return _react[\"default\"].createElement(_ContainerComponent, _extends({}, props, {\n            loading: loading\n          }), children);\n        },\n        field: field,\n        initialSqon: initialSqon,\n        onSubmit: onSubmit,\n        onCancel: onCancel,\n        sqonPath: sqonPath,\n        fieldDisplayNameMap: fieldDisplayNameMap,\n        opDisplayNameMap: opDisplayNameMap,\n        buckets: data ? (0, _lodash.get)(data, \"\".concat(arrangerProjectIndex, \".aggregations.\").concat(gqlField, \".buckets\")) : []\n      });\n    }\n  });\n};\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"script"}