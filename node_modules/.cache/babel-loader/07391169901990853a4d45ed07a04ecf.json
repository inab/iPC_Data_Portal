{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _recompose = require(\"recompose\");\n\nvar _lodash = require(\"lodash\");\n\nvar _search = _interopRequireDefault(require(\"react-icons/lib/fa/search\"));\n\nvar _emotion = require(\"emotion\");\n\nrequire(\"./AggregationCard.css\");\n\nvar _utils = require(\"../SQONView/utils\");\n\nvar _AggsWrapper = _interopRequireDefault(require(\"./AggsWrapper\"));\n\nvar _TextHighlight = _interopRequireDefault(require(\"../TextHighlight\"));\n\nrequire(\"./TermAgg.css\");\n\nvar _ToggleButton = _interopRequireDefault(require(\"../ToggleButton\"));\n\nvar _translateSQONValue = _interopRequireDefault(require(\"../utils/translateSQONValue\"));\n\nvar _Input = _interopRequireDefault(require(\"../Input\"));\n\nvar _strToReg = _interopRequireDefault(require(\"../utils/strToReg\"));\n\nvar _formatNumber = _interopRequireDefault(require(\"../utils/formatNumber\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar _generateNextSQON = function generateNextSQON(_ref) {\n  var dotField = _ref.dotField,\n      bucket = _ref.bucket,\n      isExclude = _ref.isExclude,\n      sqon = _ref.sqon;\n  return (0, _utils.toggleSQON)({\n    op: 'and',\n    content: [{\n      op: isExclude ? 'not-in' : 'in',\n      content: {\n        field: dotField,\n        value: [].concat(bucket.name || [])\n      }\n    }]\n  }, sqon);\n};\n\nvar IncludeExcludeButton = function IncludeExcludeButton(_ref2) {\n  var dotField = _ref2.dotField,\n      buckets = _ref2.buckets,\n      isActive = _ref2.isActive,\n      isExclude = _ref2.isExclude,\n      updateIsExclude = _ref2.updateIsExclude,\n      handleIncludeExcludeChange = _ref2.handleIncludeExcludeChange;\n  return _react.default.createElement(_ToggleButton.default, {\n    value: isExclude ? 'exclude' : 'include',\n    options: [{\n      title: 'Include',\n      value: 'include'\n    }, {\n      title: 'Exclude',\n      value: 'exclude'\n    }],\n    onChange: function onChange(_ref3) {\n      var value = _ref3.value,\n          _ref3$isExclude = _ref3.isExclude,\n          isExclude = _ref3$isExclude === void 0 ? value === 'exclude' : _ref3$isExclude;\n      var activeBuckets = buckets.filter(function (b) {\n        return isActive({\n          field: dotField,\n          value: b.name\n        });\n      });\n      handleIncludeExcludeChange({\n        isExclude: isExclude,\n        buckets: activeBuckets,\n        generateNextSQON: function generateNextSQON(sqon) {\n          return activeBuckets.reduce(function (q, bucket) {\n            return _generateNextSQON({\n              dotField: dotField,\n              isExclude: isExclude,\n              bucket: bucket,\n              sqon: q\n            });\n          }, (0, _utils.removeSQON)(dotField, sqon));\n        }\n      });\n      updateIsExclude(isExclude);\n    }\n  });\n};\n\nvar MoreOrLessButton = function MoreOrLessButton(_ref4) {\n  var howManyMore = _ref4.howManyMore,\n      isMore = _ref4.isMore,\n      onClick = _ref4.onClick;\n  return _react.default.createElement(\"div\", {\n    className: \"showMore-wrapper \".concat(isMore ? 'more' : 'less'),\n    onClick: onClick\n  }, isMore ? \"\".concat(howManyMore, \" More\") : 'Less');\n};\n\nvar decorateBuckets = function decorateBuckets(_ref5) {\n  var buckets = _ref5.buckets,\n      searchText = _ref5.searchText;\n  var namedFilteredBuckets = buckets.map(function (b) {\n    return _objectSpread({}, b, {\n      name: b.key_as_string || b.key\n    });\n  }).filter(function (b) {\n    return !searchText || (0, _translateSQONValue.default)(b.name).match((0, _strToReg.default)(searchText));\n  });\n\n  var _partition = (0, _lodash.partition)(namedFilteredBuckets, {\n    name: '__missing__'\n  }),\n      _partition2 = _slicedToArray(_partition, 2),\n      missing = _partition2[0],\n      notMissing = _partition2[1];\n\n  return [].concat(_toConsumableArray((0, _lodash.orderBy)(notMissing, 'doc_count', 'desc')), _toConsumableArray(missing));\n};\n\nvar enhance = (0, _recompose.compose)((0, _recompose.withState)('stateShowingMore', 'setShowingMore', false), (0, _recompose.withState)('stateIsExclude', 'setIsExclude', false), (0, _recompose.withState)('stateShowingSearch', 'setShowingSearch', false), (0, _recompose.withState)('searchText', 'setSearchText', ''));\n\nvar TermAgg = function TermAgg(_ref6) {\n  var _ref6$field = _ref6.field,\n      field = _ref6$field === void 0 ? '' : _ref6$field,\n      _ref6$displayName = _ref6.displayName,\n      displayName = _ref6$displayName === void 0 ? 'Unnamed Field' : _ref6$displayName,\n      _ref6$headerTitle = _ref6.headerTitle,\n      headerTitle = _ref6$headerTitle === void 0 ? null : _ref6$headerTitle,\n      _ref6$buckets = _ref6.buckets,\n      buckets = _ref6$buckets === void 0 ? [] : _ref6$buckets,\n      _ref6$handleValueClic = _ref6.handleValueClick,\n      handleValueClick = _ref6$handleValueClic === void 0 ? function () {} : _ref6$handleValueClic,\n      _ref6$isActive = _ref6.isActive,\n      isActive = _ref6$isActive === void 0 ? function () {} : _ref6$isActive,\n      _ref6$Content = _ref6.Content,\n      Content = _ref6$Content === void 0 ? 'div' : _ref6$Content,\n      _ref6$SearchIcon = _ref6.SearchIcon,\n      SearchIcon = _ref6$SearchIcon === void 0 ? _search.default : _ref6$SearchIcon,\n      _ref6$maxTerms = _ref6.maxTerms,\n      maxTerms = _ref6$maxTerms === void 0 ? 5 : _ref6$maxTerms,\n      _ref6$collapsible = _ref6.collapsible,\n      collapsible = _ref6$collapsible === void 0 ? true : _ref6$collapsible,\n      _ref6$isExclude = _ref6.isExclude,\n      externalIsExclude = _ref6$isExclude === void 0 ? function () {} : _ref6$isExclude,\n      _ref6$showExcludeOpti = _ref6.showExcludeOption,\n      showExcludeOption = _ref6$showExcludeOpti === void 0 ? false : _ref6$showExcludeOpti,\n      _ref6$handleIncludeEx = _ref6.handleIncludeExcludeChange,\n      handleIncludeExcludeChange = _ref6$handleIncludeEx === void 0 ? function () {} : _ref6$handleIncludeEx,\n      _ref6$constructEntryI = _ref6.constructEntryId,\n      constructEntryId = _ref6$constructEntryI === void 0 ? function (_ref7) {\n    var value = _ref7.value;\n    return value;\n  } : _ref6$constructEntryI,\n      valueCharacterLimit = _ref6.valueCharacterLimit,\n      _ref6$observableValue = _ref6.observableValueInFocus,\n      observableValueInFocus = _ref6$observableValue === void 0 ? null : _ref6$observableValue,\n      WrapperComponent = _ref6.WrapperComponent,\n      highlightText = _ref6.highlightText,\n      _ref6$constructBucket = _ref6.constructBucketItemClassName,\n      constructBucketItemClassName = _ref6$constructBucket === void 0 ? function () {\n    return '';\n  } : _ref6$constructBucket,\n      _ref6$searchPlacehold = _ref6.searchPlaceholder,\n      searchPlaceholder = _ref6$searchPlacehold === void 0 ? 'Search' : _ref6$searchPlacehold,\n      containerRef = _ref6.containerRef,\n      _ref6$aggWrapperRef = _ref6.aggWrapperRef,\n      aggWrapperRef = _ref6$aggWrapperRef === void 0 ? _react.default.createRef() : _ref6$aggWrapperRef,\n      _ref6$aggHeaderRef = _ref6.aggHeaderRef,\n      aggHeaderRef = _ref6$aggHeaderRef === void 0 ? _react.default.createRef() : _ref6$aggHeaderRef,\n      _ref6$scrollToAgg = _ref6.scrollToAgg,\n      scrollToAgg = _ref6$scrollToAgg === void 0 ? function () {\n    if (containerRef === null || containerRef === void 0 ? void 0 : containerRef.current) containerRef.current.scrollTop = aggWrapperRef.current.offsetTop - aggHeaderRef.current.getBoundingClientRect().height;\n  } : _ref6$scrollToAgg,\n      stateShowingMore = _ref6.stateShowingMore,\n      setShowingMore = _ref6.setShowingMore,\n      stateIsExclude = _ref6.stateIsExclude,\n      setIsExclude = _ref6.setIsExclude,\n      stateShowingSearch = _ref6.stateShowingSearch,\n      setShowingSearch = _ref6.setShowingSearch,\n      searchText = _ref6.searchText,\n      setSearchText = _ref6.setSearchText,\n      _ref6$InputComponent = _ref6.InputComponent,\n      InputComponent = _ref6$InputComponent === void 0 ? _Input.default : _ref6$InputComponent;\n  var decoratedBuckets = decorateBuckets({\n    buckets: buckets,\n    searchText: searchText\n  });\n  var dotField = field.replace(/__/g, '.');\n  var isExclude = externalIsExclude({\n    field: dotField\n  }) || stateIsExclude;\n  var hasSearchHit = highlightText && decoratedBuckets.some(function (x) {\n    return x.name.match((0, _strToReg.default)(searchText));\n  });\n  var showingMore = stateShowingMore || hasSearchHit;\n  var isMoreEnabled = decoratedBuckets.length > maxTerms;\n  return _react.default.createElement(_AggsWrapper.default, _extends({\n    componentRef: aggWrapperRef,\n    headerRef: aggHeaderRef,\n    stickyHeader: true\n  }, {\n    displayName: displayName,\n    WrapperComponent: WrapperComponent,\n    collapsible: collapsible\n  }, {\n    ActionIcon: _react.default.createElement(_search.default, {\n      onClick: function onClick() {\n        return setShowingSearch(!stateShowingSearch);\n      }\n    }),\n    filters: [].concat(_toConsumableArray(stateShowingSearch ? [_react.default.createElement(_react.default.Fragment, null, _react.default.createElement(InputComponent, {\n      className:\n      /*#__PURE__*/\n\n      /*#__PURE__*/\n      (0, _emotion.css)(\"flex-grow:1;\"),\n      type: \"text\",\n      value: searchText,\n      placeholder: searchPlaceholder,\n      icon: _react.default.createElement(_search.default, null),\n      onChange: function onChange(_ref8) {\n        var value = _ref8.target.value;\n        return setSearchText(value || '');\n      },\n      setSearchText: setSearchText,\n      \"aria-label\": \"Search data\"\n    }), showingMore && isMoreEnabled && _react.default.createElement(MoreOrLessButton, {\n      isMore: false,\n      onClick: function onClick() {\n        setShowingMore(false);\n        setShowingSearch(false);\n        scrollToAgg();\n      }\n    }))] : []), _toConsumableArray(showExcludeOption && !(0, _lodash.isEmpty)(decoratedBuckets) ? [_react.default.createElement(IncludeExcludeButton, {\n      dotField: dotField,\n      isActive: isActive,\n      isExclude: isExclude,\n      handleIncludeExcludeChange: handleIncludeExcludeChange,\n      buckets: decoratedBuckets,\n      updateIsExclude: setIsExclude\n    })] : []))\n  }), _react.default.createElement(_react.default.Fragment, null, headerTitle && _react.default.createElement(\"div\", {\n    className: \"header\"\n  }, headerTitle), _react.default.createElement(\"div\", {\n    className: \"bucket\"\n  }, decoratedBuckets.slice(0, showingMore ? Infinity : maxTerms).map(function (bucket, i, array) {\n    return _react.default.createElement(Content, {\n      id: constructEntryId({\n        value: bucket.name\n      }),\n      key: bucket.name,\n      className: \"bucket-item \".concat(constructBucketItemClassName({\n        bucket: bucket,\n        i: i,\n        showingBuckets: array,\n        showingMore: showingMore\n      }) || ''),\n      content: {\n        field: dotField,\n        value: bucket.name\n      },\n      onClick: function onClick() {\n        return handleValueClick({\n          field: dotField,\n          value: bucket,\n          isExclude: isExclude,\n          generateNextSQON: function generateNextSQON(sqon) {\n            return _generateNextSQON({\n              isExclude: isExclude,\n              dotField: dotField,\n              bucket: bucket,\n              sqon: sqon\n            });\n          }\n        });\n      }\n    }, _react.default.createElement(\"span\", {\n      className: \"bucket-link\",\n      merge: \"toggle\"\n    }, _react.default.createElement(\"input\", {\n      readOnly: true,\n      type: \"checkbox\",\n      checked: isActive({\n        field: dotField,\n        value: bucket.name\n      }),\n      \"aria-label\": \"Select \".concat(bucket.name),\n      id: \"input-\".concat(field, \"-\").concat(bucket.name.replace(/\\s/g, '-')),\n      name: \"input-\".concat(field, \"-\").concat(bucket.name.replace(/\\s/g, '-'))\n    }), _react.default.createElement(_TextHighlight.default, {\n      content: (0, _lodash.truncate)((0, _translateSQONValue.default)(bucket.name), {\n        length: valueCharacterLimit || Infinity\n      }) + ' ',\n      highlightText: highlightText\n    })), bucket.doc_count && _react.default.createElement(\"span\", {\n      className: \"bucket-count\"\n    }, (0, _formatNumber.default)(bucket.doc_count)));\n  })), isMoreEnabled && _react.default.createElement(MoreOrLessButton, {\n    isMore: !showingMore,\n    onClick: function onClick() {\n      setShowingMore(!showingMore);\n      setShowingSearch(!showingMore);\n      if (showingMore) scrollToAgg();\n    },\n    howManyMore: decoratedBuckets.length - maxTerms\n  })));\n};\n\nvar _default = enhance(TermAgg);\n\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}