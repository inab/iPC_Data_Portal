{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.accessor = exports.underscoreField = void 0;\n\nvar _emotion = require(\"emotion\");\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactSpinkit = _interopRequireDefault(require(\"react-spinkit\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _Query = _interopRequireDefault(require(\"../Query\"));\n\nvar _Aggs = require(\"../Aggs\");\n\nvar _formatNumber = _interopRequireDefault(require(\"../utils/formatNumber\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nvar underscoreField = function underscoreField(str) {\n  return (str || '').split('.').join('__');\n};\n\nexports.underscoreField = underscoreField;\n\nvar accessor = function accessor(_ref) {\n  var aggsField = _ref.aggsField,\n      dataAccessor = _ref.dataAccessor;\n  return \"\".concat(underscoreField(aggsField === null || aggsField === void 0 ? void 0 : aggsField.field), \".\").concat(dataAccessor || ((aggsField === null || aggsField === void 0 ? void 0 : aggsField.isTerms) ? \"buckets.length\" : \"stats.count\"));\n};\n\nexports.accessor = accessor;\n\nvar constructQuery = function constructQuery(_ref2) {\n  var graphqlField = _ref2.graphqlField,\n      query = _ref2.query,\n      _ref2$resolver = _ref2.resolver,\n      resolver = _ref2$resolver === void 0 ? 'aggregations' : _ref2$resolver;\n  return \"\\n  query($sqon: JSON) {\\n    data: \".concat(graphqlField, \" {\\n      \").concat(resolver, \"(\\n        filters: $sqon\\n        \").concat(resolver === 'aggregations' ? 'include_missing: false' : '', \"\\n        \").concat(resolver === 'aggregations' ? 'aggregations_filter_themselves: true' : '', \"\\n      ) {\\n        \").concat(query, \"\\n      }\\n    }\\n  }\\n\");\n};\n\nvar LoadingSpinner = function LoadingSpinner() {\n  return _react.default.createElement(_reactSpinkit.default, {\n    fadeIn: \"none\",\n    name: \"circle\",\n    color: \"#a9adc0\",\n    style: {\n      width: 15,\n      height: 15,\n      marginRight: 9\n    }\n  });\n};\n\nvar RootQuery = function RootQuery(_ref3) {\n  var graphqlField = _ref3.graphqlField,\n      _render = _ref3.render,\n      sqon = _ref3.sqon,\n      props = _objectWithoutProperties(_ref3, [\"graphqlField\", \"render\", \"sqon\"]);\n\n  return _react.default.createElement(_Query.default, _extends({}, props, {\n    shouldFetch: true,\n    renderError: true,\n    variables: {\n      sqon: sqon\n    },\n    name: \"StatsRootQuery\",\n    query: constructQuery({\n      graphqlField: graphqlField,\n      resolver: 'hits',\n      query: 'total'\n    }),\n    render: function render(_ref4) {\n      var data = _ref4.data,\n          error = _ref4.error,\n          loading = _ref4.loading,\n          value = _ref4.value;\n      return _render({\n        loading: loading,\n        value: (0, _lodash.get)(data, \"data.hits.total\", '')\n      });\n    }\n  }));\n};\n\nvar FieldQuery = function FieldQuery(_ref5) {\n  var aggs = _ref5.aggsState.aggs,\n      field = _ref5.field,\n      _render2 = _ref5.render,\n      sqon = _ref5.sqon,\n      graphqlField = _ref5.graphqlField,\n      dataAccessor = _ref5.dataAccessor,\n      _ref5$formatResult = _ref5.formatResult,\n      formatResult = _ref5$formatResult === void 0 ? function (x) {\n    return x;\n  } : _ref5$formatResult,\n      _ref5$aggsField = _ref5.aggsField,\n      aggsField = _ref5$aggsField === void 0 ? aggs.find(function (x) {\n    return x.field === underscoreField(field);\n  }) : _ref5$aggsField,\n      props = _objectWithoutProperties(_ref5, [\"aggsState\", \"field\", \"render\", \"sqon\", \"graphqlField\", \"dataAccessor\", \"formatResult\", \"aggsField\"]);\n\n  return _react.default.createElement(_Query.default, _extends({}, props, {\n    renderError: true,\n    name: \"StatsFieldQuery\",\n    shouldFetch: aggs.length,\n    variables: {\n      sqon: sqon\n    },\n    query: constructQuery({\n      graphqlField: graphqlField,\n      query: aggsField === null || aggsField === void 0 ? void 0 : aggsField.query\n    }),\n    render: function render(_ref6) {\n      var data = _ref6.data,\n          loading = _ref6.loading;\n      return _render2({\n        loading: loading,\n        value: formatResult((0, _lodash.get)(data, \"data.aggregations.\".concat(accessor({\n          aggsField: aggsField,\n          dataAccessor: dataAccessor\n        })), ''))\n      });\n    }\n  }));\n};\n\nvar Stat = function Stat(_ref7) {\n  var _ref7$icon = _ref7.icon,\n      icon = _ref7$icon === void 0 ? '' : _ref7$icon,\n      _ref7$label = _ref7.label,\n      label = _ref7$label === void 0 ? '' : _ref7$label,\n      _ref7$isRoot = _ref7.isRoot,\n      isRoot = _ref7$isRoot === void 0 ? false : _ref7$isRoot,\n      LoadingSpinnerComponent = _ref7.LoadingSpinnerComponent,\n      _ref7$QueryComponent = _ref7.QueryComponent,\n      QueryComponent = _ref7$QueryComponent === void 0 ? isRoot ? RootQuery : FieldQuery : _ref7$QueryComponent,\n      props = _objectWithoutProperties(_ref7, [\"icon\", \"label\", \"isRoot\", \"LoadingSpinnerComponent\", \"QueryComponent\"]);\n\n  return _react.default.createElement(\"div\", {\n    className: \"stat-container\"\n  }, icon, _react.default.createElement(\"div\", {\n    className: \"stat-content\"\n  }, _react.default.createElement(QueryComponent, _extends({}, props, {\n    render: function render(x) {\n      return x.loading ? _react.default.createElement(LoadingSpinnerComponent, null) : (0, _formatNumber.default)(x.value);\n    }\n  }))), _react.default.createElement(\"div\", {\n    className: \"stat-label\"\n  }, label));\n};\n\nvar _default = function _default(_ref8) {\n  var api = _ref8.api,\n      projectId = _ref8.projectId,\n      graphqlField = _ref8.graphqlField,\n      stats = _ref8.stats,\n      className = _ref8.className,\n      render = _ref8.render,\n      small = _ref8.small,\n      transparent = _ref8.transparent,\n      _ref8$LoadingSpinnerC = _ref8.LoadingSpinnerComponent,\n      LoadingSpinnerComponent = _ref8$LoadingSpinnerC === void 0 ? LoadingSpinner : _ref8$LoadingSpinnerC,\n      props = _objectWithoutProperties(_ref8, [\"api\", \"projectId\", \"graphqlField\", \"stats\", \"className\", \"render\", \"small\", \"transparent\", \"LoadingSpinnerComponent\"]);\n\n  return _react.default.createElement(\"div\", {\n    className: (0, _emotion.merge)(\n    /*#__PURE__*/\n    (0, _emotion.css)(\"display:flex;align-items:center;\", className, \";\") + (\" \" + \"\\n      stats-container\\n      \".concat(small ? \"small\" : \"\", \"\\n      \").concat(transparent ? \"transparent\" : \"\", \"\\n    \")))\n  }, _react.default.createElement(_Aggs.AggsState, _extends({\n    api: api,\n    projectId: projectId,\n    graphqlField: graphqlField\n  }, {\n    render: function render(aggsState) {\n      return stats.map(function (stat, i) {\n        return _react.default.createElement(_react.Fragment, {\n          key: stat.label\n        }, i > 0 && _react.default.createElement(\"div\", {\n          key: i,\n          className: \"stats-line\"\n        }), _react.default.createElement(Stat, _extends({\n          aggsState: aggsState,\n          api: api,\n          projectId: projectId,\n          graphqlField: graphqlField,\n          LoadingSpinnerComponent: LoadingSpinnerComponent\n        }, props, stat)));\n      });\n    }\n  })));\n};\n\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}