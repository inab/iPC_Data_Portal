{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.RangeFilterUi = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactComponentComponent = _interopRequireDefault(require(\"react-component-component\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _convertUnits = _interopRequireDefault(require(\"convert-units\"));\n\nrequire(\"./FilterContainerStyle.css\");\n\nvar _utils = require(\"../utils\");\n\nvar _common = require(\"./common\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar SUPPORTED_CONVERSIONS = {\n  time: ['d', 'month', 'year'],\n  digital: ['GB', 'B']\n};\nvar UNITS_DISPLAY_NAMES = {\n  d: 'day'\n};\n\nvar toUnitDisplayName = function toUnitDisplayName(unit) {\n  return UNITS_DISPLAY_NAMES[unit] || unit;\n};\n\nvar supportedConversionFromUnit = function supportedConversionFromUnit(unit) {\n  return unit ? SUPPORTED_CONVERSIONS[(0, _convertUnits.default)().describe(unit).measure] : null;\n};\n\nvar normalizeNumericFieldOp = function normalizeNumericFieldOp(fieldOp) {\n  return _objectSpread({}, fieldOp, {\n    content: _objectSpread({}, fieldOp.content, {\n      value: Array.isArray(fieldOp.content.value) ? [(0, _lodash.min)(fieldOp.content.value), (0, _lodash.max)(fieldOp.content.value)] : [fieldOp.content.value]\n    })\n  });\n};\n\nvar convertUnit = function convertUnit(sourceUnit, targetUnit) {\n  return function (num) {\n    return sourceUnit && targetUnit ? (0, _convertUnits.default)(num).from(sourceUnit).to(targetUnit) : num;\n  };\n};\n\nvar RangeFilterUi = function RangeFilterUi(props) {\n  var _props$field = props.field,\n      fieldName = _props$field === void 0 ? null : _props$field,\n      _props$sqonPath = props.sqonPath,\n      sqonPath = _props$sqonPath === void 0 ? [] : _props$sqonPath,\n      _props$initialSqon = props.initialSqon,\n      initialSqon = _props$initialSqon === void 0 ? null : _props$initialSqon,\n      _props$onSubmit = props.onSubmit,\n      onSubmit = _props$onSubmit === void 0 ? function (sqon) {} : _props$onSubmit,\n      _props$onCancel = props.onCancel,\n      onCancel = _props$onCancel === void 0 ? function () {} : _props$onCancel,\n      _props$fieldDisplayNa = props.fieldDisplayNameMap,\n      fieldDisplayNameMap = _props$fieldDisplayNa === void 0 ? {} : _props$fieldDisplayNa,\n      _props$opDisplayNameM = props.opDisplayNameMap,\n      opDisplayNameMap = _props$opDisplayNameM === void 0 ? _utils.FIELD_OP_DISPLAY_NAME : _props$opDisplayNameM,\n      _props$ContainerCompo = props.ContainerComponent,\n      ContainerComponent = _props$ContainerCompo === void 0 ? _common.FilterContainer : _props$ContainerCompo,\n      _props$InputComponent = props.InputComponent,\n      InputComponent = _props$InputComponent === void 0 ? function (props) {\n    return _react.default.createElement(\"input\", _extends({}, props, {\n      className: \"rangeFilterInput \".concat(props.className || '')\n    }));\n  } : _props$InputComponent,\n      _props$unit = props.unit,\n      originalUnit = _props$unit === void 0 ? null : _props$unit;\n\n  var initialFieldOp = function () {\n    var fieldOp = (0, _utils.getOperationAtPath)(sqonPath)(initialSqon);\n    return fieldOp ? normalizeNumericFieldOp(fieldOp) : {\n      op: _utils.BETWEEN_OP,\n      content: {\n        value: [],\n        field: fieldName || fieldOp.content.field\n      }\n    };\n  }();\n\n  var field = fieldName || initialFieldOp.content.field;\n  var initialState = {\n    selectedOperation: initialFieldOp.op,\n    minValue: (0, _lodash.min)(initialFieldOp.content.value),\n    maxValue: (0, _lodash.max)(initialFieldOp.content.value),\n    selectedUnit: originalUnit\n  };\n\n  var onSqonSubmit = function onSqonSubmit(s) {\n    return function () {\n      var op = s.state.selectedOperation;\n      var toOriginalUnit = convertUnit(s.state.selectedUnit, originalUnit);\n      var min = toOriginalUnit(s.state.minValue);\n      var max = toOriginalUnit(s.state.maxValue);\n      var value = [_utils.GTE_OP, _utils.GT_OP].includes(op) ? [min] : [_utils.LTE_OP, _utils.LT_OP].includes(op) ? [max] : [min, max];\n      var sqonToSubmit = {\n        op: op,\n        content: {\n          field: field,\n          value: value\n        }\n      };\n      onSubmit((0, _utils.setSqonAtPath)(sqonPath, sqonToSubmit)(initialSqon));\n    };\n  };\n\n  var onOptionTypeChange = function onOptionTypeChange(s) {\n    return function (e) {\n      s.setState({\n        selectedOperation: e.target.value\n      });\n    };\n  };\n\n  var onMinimumChange = function onMinimumChange(s) {\n    return function (e) {\n      s.setState({\n        minValue: e.target.value\n      });\n    };\n  };\n\n  var onMaximumChange = function onMaximumChange(s) {\n    return function (e) {\n      s.setState({\n        maxValue: e.target.value\n      });\n    };\n  };\n\n  var onClearClick = function onClearClick(s) {\n    return function (e) {\n      s.setState({\n        maxValue: '',\n        minValue: ''\n      });\n    };\n  };\n\n  var unitOptions = supportedConversionFromUnit(originalUnit) || [];\n\n  var onUnitOptionSelect = function onUnitOptionSelect(s) {\n    return function (e) {\n      s.setState({\n        selectedUnit: e.target.value\n      });\n    };\n  };\n\n  var isMinimumDisabled = function isMinimumDisabled(s) {\n    return [_utils.LTE_OP, _utils.LT_OP].includes(s.state.selectedOperation);\n  };\n\n  var isMaximumDisabled = function isMaximumDisabled(s) {\n    return [_utils.GTE_OP, _utils.GT_OP].includes(s.state.selectedOperation);\n  };\n\n  var StyledInputComponent = function StyledInputComponent(props) {\n    return _react.default.createElement(InputComponent, _extends({}, props, {\n      className: \"rangeFilterInput \".concat(props.className || '')\n    }));\n  };\n\n  return _react.default.createElement(_reactComponentComponent.default, {\n    initialState: initialState\n  }, function (s) {\n    return _react.default.createElement(ContainerComponent, {\n      onSubmit: onSqonSubmit(s),\n      onCancel: onCancel\n    }, _react.default.createElement(\"div\", {\n      className: \"filterContent\"\n    }, _react.default.createElement(\"div\", {\n      className: \"contentSection\"\n    }, _react.default.createElement(\"span\", null, fieldDisplayNameMap[field] || field), \" is\", ' ', _react.default.createElement(\"select\", {\n      onChange: onOptionTypeChange(s)\n    }, _utils.RANGE_OPS.map(function (option) {\n      return _react.default.createElement(\"option\", {\n        key: option,\n        value: option,\n        selected: s.state.selectedOperation === option\n      }, opDisplayNameMap[option]);\n    }))), _react.default.createElement(\"div\", {\n      className: \"contentSection\"\n    }, _react.default.createElement(\"span\", {\n      onClick: onClearClick(s),\n      className: \"aggsFilterAction\"\n    }, \"Clear\")), _react.default.createElement(\"form\", {\n      className: \"contentSection\"\n    }, unitOptions.map(function (unit) {\n      return _react.default.createElement(\"label\", {\n        className: \"unitOptionLabel\",\n        key: unit\n      }, _react.default.createElement(\"input\", {\n        type: \"radio\",\n        name: unit,\n        value: unit,\n        checked: s.state.selectedUnit === unit,\n        onChange: onUnitOptionSelect(s)\n      }), ' ', toUnitDisplayName(unit));\n    })), _react.default.createElement(\"div\", {\n      className: \"contentSection\"\n    }, _react.default.createElement(\"div\", {\n      className: \"rangeInputContainer\"\n    }, _react.default.createElement(\"div\", {\n      className: \"inputField\"\n    }, _react.default.createElement(\"span\", {\n      className: \"inputLabel \".concat(isMinimumDisabled(s) ? 'disabled' : '')\n    }, \"From:\"), _react.default.createElement(StyledInputComponent, {\n      disabled: isMinimumDisabled(s),\n      value: s.state.minValue,\n      type: 'number',\n      onChange: onMinimumChange(s)\n    })), _react.default.createElement(\"div\", {\n      className: \"inputField\"\n    }, _react.default.createElement(\"span\", {\n      className: \"inputLabel \".concat(isMaximumDisabled(s) ? 'disabled' : '')\n    }, \"To:\"), _react.default.createElement(StyledInputComponent, {\n      disabled: isMaximumDisabled(s),\n      value: s.state.maxValue,\n      type: 'number',\n      onChange: onMaximumChange(s)\n    }))))));\n  });\n};\n\nexports.RangeFilterUi = RangeFilterUi;\n\nvar RangeFilter = function RangeFilter(_ref) {\n  var _ref$sqonPath = _ref.sqonPath,\n      sqonPath = _ref$sqonPath === void 0 ? [] : _ref$sqonPath,\n      _ref$initialSqon = _ref.initialSqon,\n      initialSqon = _ref$initialSqon === void 0 ? null : _ref$initialSqon,\n      _ref$onSubmit = _ref.onSubmit,\n      onSubmit = _ref$onSubmit === void 0 ? function (sqon) {} : _ref$onSubmit,\n      _ref$onCancel = _ref.onCancel,\n      onCancel = _ref$onCancel === void 0 ? function () {} : _ref$onCancel,\n      _ref$fieldDisplayName = _ref.fieldDisplayNameMap,\n      fieldDisplayNameMap = _ref$fieldDisplayName === void 0 ? {} : _ref$fieldDisplayName,\n      _ref$opDisplayNameMap = _ref.opDisplayNameMap,\n      opDisplayNameMap = _ref$opDisplayNameMap === void 0 ? _utils.FIELD_OP_DISPLAY_NAME : _ref$opDisplayNameMap,\n      _ref$ContainerCompone = _ref.ContainerComponent,\n      ContainerComponent = _ref$ContainerCompone === void 0 ? _common.FilterContainer : _ref$ContainerCompone,\n      _ref$InputComponent = _ref.InputComponent,\n      InputComponent = _ref$InputComponent === void 0 ? function (props) {\n    return _react.default.createElement(\"input\", props);\n  } : _ref$InputComponent,\n      _ref$unit = _ref.unit,\n      unit = _ref$unit === void 0 ? null : _ref$unit,\n      field = _ref.field;\n  return _react.default.createElement(RangeFilterUi, {\n    field: field,\n    ContainerComponent: ContainerComponent,\n    sqonPath: sqonPath,\n    initialSqon: initialSqon,\n    onSubmit: onSubmit,\n    onCancel: onCancel,\n    fieldDisplayNameMap: fieldDisplayNameMap,\n    opDisplayNameMap: opDisplayNameMap,\n    InputComponent: InputComponent,\n    unit: unit\n  });\n};\n\nRangeFilter.prototype = {\n  field: _propTypes.default.string,\n  sqonPath: _propTypes.default.arrayOf(_propTypes.default.number),\n  initialSqon: _propTypes.default.object,\n  onSubmit: _propTypes.default.func,\n  onCancel: _propTypes.default.func,\n  fieldDisplayNameMap: _propTypes.default.objectOf(_propTypes.default.string),\n  opDisplayNameMap: _propTypes.default.objectOf(_propTypes.default.string),\n  ContainerComponent: _propTypes.default.func,\n  InputComponent: _propTypes.default.func,\n  unit: _propTypes.default.string\n};\nvar _default = RangeFilter;\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}