'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports.default = createStyledComponent;

var _reactEmotion = require('react-emotion');

var _reactEmotion2 = _interopRequireDefault(_reactEmotion);

var _withProps = require('recompose/withProps');

var _withProps2 = _interopRequireDefault(_withProps);

var _componentStyleReset = require('./componentStyleReset');

var _componentStyleReset2 = _interopRequireDefault(_componentStyleReset);

var _isValidProp = require('../utils/isValidProp');

var _isValidProp2 = _interopRequireDefault(_isValidProp);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function createStyledComponent(element, styles) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var displayName = options.displayName,
      _options$filterProps = options.filterProps,
      filterProps = _options$filterProps === undefined ? [] : _options$filterProps,
      _options$forwardProps = options.forwardProps,
      forwardProps = _options$forwardProps === undefined ? [] : _options$forwardProps,
      includeStyleReset = options.includeStyleReset,
      rootEl = options.rootEl,
      withProps = options.withProps;

  var outStyles = function outStyles(props, context) {
    var componentStyles = typeof styles === 'function' ? styles(props, context) : styles;

    if (includeStyleReset) {
      var resetStyles = (0, _componentStyleReset2.default)(props);
      if (Array.isArray(componentStyles)) {
        componentStyles.unshift(resetStyles);
      } else {
        componentStyles = _extends({}, resetStyles, componentStyles);
      }
    }

    return componentStyles;
  };

  if (displayName && typeof element !== 'string') {
    element.displayName = displayName;
  }

  var styledComponent = (0, _reactEmotion2.default)(element, _extends({}, process.env.NODE_ENV !== 'production' && displayName ? { label: displayName } : undefined, {
    shouldForwardProp: function shouldForwardProp(prop) {
      /*
       * These props are filtered in Emotion's default implementation of
       * shouldForwardProp, which this overrides.
       */
      var filteredProps = ['innerRef', 'theme'].concat(filterProps);
      var isFiltered = filteredProps.indexOf(prop) !== -1;
      var isForwarded = forwardProps.indexOf(prop) !== -1;
      var tag = typeof element === 'string' ? element : rootEl;

      return !isFiltered && (isForwarded || (0, _isValidProp2.default)(tag, prop));
    }
  }))(outStyles);

  return withProps ? (0, _withProps2.default)(withProps)(styledComponent) : styledComponent;
}